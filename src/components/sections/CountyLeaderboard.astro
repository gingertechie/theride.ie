---
/**
 * County Leaderboard Component
 * Displays the top counties by bike count with a podium-style layout
 * Follows the Velvet & Neon design system
 */

interface CountyStats {
  county: string;
  total_bikes: number;
  sensor_count: number;
  avg_bikes_per_sensor: number;
}

interface Props {
  counties: CountyStats[];
}

const { counties } = Astro.props;

// Medal colors for top 3
const medals = [
  { emoji: 'ðŸ¥‡', color: 'neon-yellow', glow: 'glow-yellow', position: 1 },
  { emoji: 'ðŸ¥ˆ', color: 'text-gray-300', glow: '', position: 2 },
  { emoji: 'ðŸ¥‰', color: 'neon-orange', glow: 'glow-orange', position: 3 },
];

// Convert county name to slug (e.g., "County Dublin" -> "dublin")
const countyToSlug = (county: string) => {
  return county.toLowerCase().replace('county ', '').trim();
};
---

<div class="w-full">
  <h2 class="text-2xl md:text-4xl text-white mb-8 text-center font-medium">
    County <span class="greenhead text-glow-green">Leaderboard</span>
  </h2>

  {counties.length > 0 ? (
    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 md:gap-6 max-w-5xl mx-auto">
      {counties.slice(0, 3).map((county, index) => {
        const medal = medals[index];
        const isPodiumTop = index === 0;
        const countySlug = countyToSlug(county.county);

        return (
          <a
            href={`/county/${countySlug}`}
            class={`
              block
              ${isPodiumTop ? 'md:col-start-2 md:row-start-1' : ''}
              ${index === 1 ? 'md:col-start-1 md:row-start-2' : ''}
              ${index === 2 ? 'md:col-start-3 md:row-start-2' : ''}
              bg-velvet-midnight rounded-2xl p-6
              ${isPodiumTop ? 'neon-border-green neon-glow-green' : 'border-2 border-velvet-charcoal'}
              transition-all duration-300 hover:scale-105
              ${isPodiumTop ? 'md:transform md:scale-110' : ''}
              group cursor-pointer
            `}
          >
            {/* Medal Position */}
            <div class="text-center mb-4">
              <div class="text-5xl mb-2">{medal.emoji}</div>
              <div class={`text-lg font-medium ${index === 0 ? 'text-neon-yellow text-glow-yellow' : index === 2 ? 'text-neon-orange' : 'text-gray-300'}`}>
                #{medal.position}
              </div>
            </div>

            {/* County Name */}
            <h3 class={`text-2xl font-bold text-center mb-4 ${isPodiumTop ? 'text-neon-green text-glow-green' : 'text-white'}`}>
              {county.county}
            </h3>

            {/* Bike Count */}
            <div class="text-center mb-4">
              <div class={`text-4xl font-bold mb-1 ${isPodiumTop ? 'text-neon-green' : 'text-neon-cyan'}`}>
                {Math.round(county.total_bikes).toLocaleString()}
              </div>
              <div class="text-text-muted text-sm">bikes counted</div>
            </div>

            {/* Stats Grid */}
            <div class="grid grid-cols-2 gap-3 mt-4 pt-4 border-t border-velvet-charcoal">
              <div class="text-center">
                <div class="text-text-secondary text-lg font-medium">
                  {county.sensor_count}
                </div>
                <div class="text-text-muted text-xs">sensors</div>
              </div>
              <div class="text-center">
                <div class="text-text-secondary text-lg font-medium">
                  {Math.round(county.avg_bikes_per_sensor).toLocaleString()}
                </div>
                <div class="text-text-muted text-xs">avg/sensor</div>
              </div>
            </div>

            {/* Podium Platform Visual Effect */}
            {isPodiumTop && (
              <div class="mt-4 h-2 bg-gradient-to-r from-transparent via-neon-green to-transparent rounded-full neon-glow-green"></div>
            )}

            {/* Click Indicator */}
            <div class="mt-4 text-center text-neon-pink text-sm opacity-0 group-hover:opacity-100 transition-opacity">
              View Details â†’
            </div>
          </a>
        );
      })}
    </div>
  ) : (
    <div class="text-center py-12">
      <p class="text-text-muted text-lg">No county data available yet</p>
    </div>
  )}

  {/* Note */}
  <div class="text-center mt-8">
    <p class="text-text-muted text-sm">
      Rankings based on total bikes counted from Telraam sensors
    </p>
  </div>
</div>

<style>
  /* Additional glow effect for orange (bronze medal) */
  .glow-orange {
    box-shadow: 0 0 10px rgba(255, 107, 26, 0.5),
                0 0 20px rgba(255, 107, 26, 0.3),
                0 0 30px rgba(255, 107, 26, 0.2);
  }
</style>
