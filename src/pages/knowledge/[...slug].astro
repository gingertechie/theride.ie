---
import MinimalLayout from "../../layouts/MinimalLayout.astro";
import { getEntry, getCollection } from 'astro:content';
import { formatDate } from "../../utils";

import "../../styles/global.css";

// Generate static paths for all knowledge articles
export async function getStaticPaths() {
  const knowledgeEntries = await getCollection('knowledge');
  return knowledgeEntries.map(entry => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { slug } = Astro.params;

if (slug === undefined) {
  throw new Error('Slug is required');
}

const entry = await getEntry('knowledge', slug);

if (entry === undefined) {
  return Astro.redirect('/404');
}

const { Content } = await entry.render();

// Difficulty badge styling
const difficultyStyles = {
  Beginner: 'bg-neon-green/20 text-neon-green border-neon-green',
  Intermediate: 'bg-neon-yellow/20 text-neon-yellow border-neon-yellow',
  Advanced: 'bg-neon-cyan/20 text-neon-cyan border-neon-cyan'
};
---

<MinimalLayout
  title={`${entry.data.title} | Knowledge Base | The Ride`}
  description={entry.data.summary}
>
  <!-- Article Header -->
  <section class="bg-velvet-black pt-24 pb-12 px-4 md:px-6">
    <div class="container mx-auto max-w-4xl">
      <!-- Back Link -->
      <a href="/knowledge" class="inline-flex items-center text-neon-yellow hover:text-glow-yellow transition-all duration-300 mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="h-5 w-5">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
        </svg>
        <span class="ml-2 font-medium">Back to Knowledge Base</span>
      </a>

      <!-- Difficulty Badge -->
      <div class="mb-4">
        <span class={`inline-block px-3 py-1 rounded-full text-xs font-medium border ${difficultyStyles[entry.data.difficulty]}`}>
          {entry.data.difficulty}
        </span>
      </div>

      <!-- Title -->
      <h1 class="text-3xl md:text-6xl font-medium text-white mb-4">
        {entry.data.title}
      </h1>

      <!-- Metadata -->
      <div class="flex flex-wrap items-center gap-4 text-text-muted text-sm mb-6">
        <span>üìñ {entry.data.readTime} read</span>
        <span>‚Ä¢</span>
        <span>Updated {formatDate(entry.data.updatedDate || entry.data.pubDate)}</span>
      </div>

      <!-- Summary -->
      <p class="text-text-secondary text-lg md:text-xl leading-relaxed mb-8">
        {entry.data.summary}
      </p>

      <div class="neon-divider mb-12"></div>
    </div>
  </section>

  <!-- Article Content -->
  <section class="bg-velvet-black py-8 px-4 md:px-6">
    <div class="container mx-auto max-w-4xl">
      <div class="prose prose-lg prose-invert max-w-none
        prose-headings:text-white prose-headings:font-medium
        prose-h2:text-3xl prose-h2:mb-4 prose-h2:mt-8
        prose-h3:text-2xl prose-h3:mb-3 prose-h3:mt-6
        prose-p:text-text-secondary prose-p:leading-relaxed prose-p:mb-4
        prose-strong:text-white prose-strong:font-semibold
        prose-a:text-neon-yellow prose-a:no-underline hover:prose-a:text-glow-yellow
        prose-ul:text-text-secondary prose-ul:mb-4
        prose-ol:text-text-secondary prose-ol:mb-4
        prose-li:mb-2
        prose-blockquote:border-l-4 prose-blockquote:border-neon-yellow prose-blockquote:pl-4 prose-blockquote:italic prose-blockquote:text-text-secondary
        prose-code:text-neon-cyan prose-code:bg-velvet-midnight prose-code:px-1 prose-code:py-0.5 prose-code:rounded">
        <Content />
      </div>
    </div>
  </section>

  <!-- Bottom Navigation -->
  <section class="bg-velvet-black py-16 px-4 md:px-6">
    <div class="container mx-auto max-w-4xl">
      <div class="neon-divider mb-8"></div>
      <div class="text-center">
        <a href="/knowledge" class="inline-block bg-velvet-midnight border-2 border-neon-yellow/30 hover:border-neon-yellow/60 text-white px-6 py-3 rounded-lg transition-all duration-300 hover:shadow-[0_0_20px_rgba(204,255,0,0.3)]">
          ‚Üê Back to Knowledge Base
        </a>
      </div>
    </div>
  </section>
</MinimalLayout>
